(* File automatically generated by Hacspec *)
From Hacspec Require Import Hacspec_Lib MachineIntegers.
From Coq Require Import ZArith.
Import List.ListNotations.
Open Scope Z_scope.
Open Scope bool_scope.

(*Not implemented yet? todo(item)*)

Require Import Hacspec_lib.

Notation PallasCanvas := (nseq int8 255).
Notation FpPallas_t := (nat_mod 0x40000000000000000000000000000000224698FC094CF91B992D30ED00000001).
Definition FpPallas : FpPallas_t -> FpPallas_t :=
  id.

Notation VestaCanvas := (nseq int8 255).
Notation FpVesta_t := (nat_mod 0x40000000000000000000000000000000224698FC0994A8DD8C46EB2100000001).
Definition FpVesta : FpVesta_t -> FpVesta_t :=
  id.

Notation G1_pallas_t := ((FpPallas_t × FpPallas_t × bool)).

Notation G1_vesta_t := ((FpVesta_t × FpVesta_t × bool)).

Definition g1_default_pallas : (FpPallas_t × FpPallas_t × bool) :=
  (zero,zero,true).

Definition g1_default_vesta : (FpVesta_t × FpVesta_t × bool) :=
  (zero,zero,true).

Definition g1add_a_pallas (p : (FpPallas_t × FpPallas_t × bool)) (q : (FpPallas_t × FpPallas_t × bool)) : (FpPallas_t × FpPallas_t × bool) :=
  let '(x1,y1,_) := (p) : (FpPallas_t × FpPallas_t × bool) in
  let '(x2,y2,_) := (q) : (FpPallas_t × FpPallas_t × bool) in
  let x_diff := (x2.-x1) : _ in
  let y_diff := (y2.-y1) : _ in
  let xovery := (y_diff.*(inv x_diff)) : _ in
  let x3 := (((exp xovery (@repr WORDSIZE32 2)).-x1).-x2) : _ in
  let y3 := ((xovery.*(x1.-x3)).-y1) : _ in
  (x3,y3,false).

Definition g1add_a_vesta (p : (FpVesta_t × FpVesta_t × bool)) (q : (FpVesta_t × FpVesta_t × bool)) : (FpVesta_t × FpVesta_t × bool) :=
  let '(x1,y1,_) := (p) : (FpVesta_t × FpVesta_t × bool) in
  let '(x2,y2,_) := (q) : (FpVesta_t × FpVesta_t × bool) in
  let x_diff := (x2.-x1) : _ in
  let y_diff := (y2.-y1) : _ in
  let xovery := (y_diff.*(inv x_diff)) : _ in
  let x3 := (((exp xovery (@repr WORDSIZE32 2)).-x1).-x2) : _ in
  let y3 := ((xovery.*(x1.-x3)).-y1) : _ in
  (x3,y3,false).

Definition g1double_a_pallas (p : (FpPallas_t × FpPallas_t × bool)) : (FpPallas_t × FpPallas_t × bool) :=
  let '(x1,y1,_) := (p) : (FpPallas_t × FpPallas_t × bool) in
  let x12 := (exp x1 (@repr WORDSIZE32 2)) : FpPallas_t in
  let xovery := (((from_literal (@repr WORDSIZE128 3)).*x12).*(inv (TWO.*y1))) : _ in
  let x3 := ((exp xovery (@repr WORDSIZE32 2)).-(TWO.*x1)) : _ in
  let y3 := ((xovery.*(x1.-x3)).-y1) : _ in
  (x3,y3,false).

Definition g1double_a_vesta (p : (FpVesta_t × FpVesta_t × bool)) : (FpVesta_t × FpVesta_t × bool) :=
  let '(x1,y1,_) := (p) : (FpVesta_t × FpVesta_t × bool) in
  let x12 := (exp x1 (@repr WORDSIZE32 2)) : FpVesta_t in
  let xovery := (((from_literal (@repr WORDSIZE128 3)).*x12).*(inv (TWO.*y1))) : _ in
  let x3 := ((exp xovery (@repr WORDSIZE32 2)).-(TWO.*x1)) : _ in
  let y3 := ((xovery.*(x1.-x3)).-y1) : _ in
  (x3,y3,false).

Definition g1double_pallas (p : (FpPallas_t × FpPallas_t × bool)) : (FpPallas_t × FpPallas_t × bool) :=
  let '(_x1,y1,inf1) := (p) : (FpPallas_t × FpPallas_t × bool) in
  if
    andb (ne y1 zero) (MachineIntegers.not inf1)
  then
    g1double_a_pallas p
  else
    (zero,zero,true).

Definition g1double_vesta (p : (FpVesta_t × FpVesta_t × bool)) : (FpVesta_t × FpVesta_t × bool) :=
  let '(_x1,y1,inf1) := (p) : (FpVesta_t × FpVesta_t × bool) in
  if
    andb (ne y1 zero) (MachineIntegers.not inf1)
  then
    g1double_a_vesta p
  else
    (zero,zero,true).

Definition g1add_pallas (p : (FpPallas_t × FpPallas_t × bool)) (q : (FpPallas_t × FpPallas_t × bool)) : (FpPallas_t × FpPallas_t × bool) :=
  let '(x1,y1,inf1) := (p) : (FpPallas_t × FpPallas_t × bool) in
  let '(x2,y2,inf2) := (q) : (FpPallas_t × FpPallas_t × bool) in
  if
    inf1
  then
    q
  else
    if
      inf2
    then
      p
    else
      if
        eq p q
      then
        g1double_pallas p
      else
        if
          MachineIntegers.not (andb (eq x1 x2) (eq y1 (zero.-y2)))
        then
          g1add_a_pallas p q
        else
          (zero,zero,true).

Definition g1add_vesta (p : (FpVesta_t × FpVesta_t × bool)) (q : (FpVesta_t × FpVesta_t × bool)) : (FpVesta_t × FpVesta_t × bool) :=
  let '(x1,y1,inf1) := (p) : (FpVesta_t × FpVesta_t × bool) in
  let '(x2,y2,inf2) := (q) : (FpVesta_t × FpVesta_t × bool) in
  if
    inf1
  then
    q
  else
    if
      inf2
    then
      p
    else
      if
        eq p q
      then
        g1double_vesta p
      else
        if
          MachineIntegers.not (andb (eq x1 x2) (eq y1 (zero.-y2)))
        then
          g1add_a_vesta p q
        else
          (zero,zero,true).

Definition g1mul_pallas (m : FpVesta_t) (p : (FpPallas_t × FpPallas_t × bool)) : (FpPallas_t × FpPallas_t × bool) :=
  let t := ((zero,zero,true)) : (FpPallas_t × FpPallas_t × bool) in
  let t := (fold (into_iter (Build_Range_t (@repr WORDSIZE32 0)(@repr WORDSIZE32 255))) t (fun i t =>
      let t := (g1double_pallas t) : (FpPallas_t × FpPallas_t × bool) in
      if
        bit m ((@repr WORDSIZE32 254).-i)
      then
        let t := (g1add_pallas t p) : (FpPallas_t × FpPallas_t × bool) in
        t
      else
        t)) : (FpPallas_t × FpPallas_t × bool) in
  t.

Definition g1mul_vesta (m : FpPallas_t) (p : (FpVesta_t × FpVesta_t × bool)) : (FpVesta_t × FpVesta_t × bool) :=
  let t := ((zero,zero,true)) : (FpVesta_t × FpVesta_t × bool) in
  let t := (fold (into_iter (Build_Range_t (@repr WORDSIZE32 0)(@repr WORDSIZE32 255))) t (fun i t =>
      let t := (g1double_vesta t) : (FpVesta_t × FpVesta_t × bool) in
      if
        bit m ((@repr WORDSIZE32 254).-i)
      then
        let t := (g1add_vesta t p) : (FpVesta_t × FpVesta_t × bool) in
        t
      else
        t)) : (FpVesta_t × FpVesta_t × bool) in
  t.

Definition g1neg_pallas (p : (FpPallas_t × FpPallas_t × bool)) : (FpPallas_t × FpPallas_t × bool) :=
  let '(x,y,inf) := (p) : (FpPallas_t × FpPallas_t × bool) in
  (x,zero.-y,inf).

Definition g1neg_vesta (p : (FpVesta_t × FpVesta_t × bool)) : (FpVesta_t × FpVesta_t × bool) :=
  let '(x,y,inf) := (p) : (FpVesta_t × FpVesta_t × bool) in
  (x,zero.-y,inf).

Definition g1_on_curve_pallas (p : (FpPallas_t × FpPallas_t × bool)) : bool :=
  let '(x,y,inf) := (p) : (FpPallas_t × FpPallas_t × bool) in
  let y_squared := (y.*y) : _ in
  let x_cubed := ((x.*x).*x) : _ in
  let fp5 := ((TWO.+TWO).+ONE) : _ in
  orb (eq y_squared (x_cubed.+fp5)) inf.

Definition g1_on_curve_vesta (p : (FpVesta_t × FpVesta_t × bool)) : bool :=
  let '(x,y,inf) := (p) : (FpVesta_t × FpVesta_t × bool) in
  let y_squared := (y.*y) : _ in
  let x_cubed := ((x.*x).*x) : _ in
  let fp5 := ((TWO.+TWO).+ONE) : _ in
  orb (eq y_squared (x_cubed.+fp5)) inf.

Definition g1_is_identity_pallas (p : (FpPallas_t × FpPallas_t × bool)) : bool :=
  let '(_,_,inf) := (p) : (FpPallas_t × FpPallas_t × bool) in
  inf.

Definition g1_is_identity_vesta (p : (FpVesta_t × FpVesta_t × bool)) : bool :=
  let '(_,_,inf) := (p) : (FpVesta_t × FpVesta_t × bool) in
  inf.
